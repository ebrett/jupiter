<div class="max-w-4xl mx-auto p-6">
  <%= form_with(model: reimbursement_request, url: reimbursement_requests_path, local: true, builder: TailwindFormBuilder, class: "space-y-8", data: { controller: "reimbursement-form" }) do |form| %>
    
    <!-- Error Summary -->
    <% if reimbursement_request.errors.any? %>
      <div class="rounded-md bg-red-50 p-4">
        <div class="flex">
          <div class="flex-shrink-0">
            <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" />
            </svg>
          </div>
          <div class="ml-3">
            <h3 class="text-sm font-medium text-red-800">Please correct the following errors:</h3>
            <div class="mt-2 text-sm text-red-700">
              <ul class="list-disc space-y-1 pl-5">
                <% reimbursement_request.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
      </div>
    <% end %>

    <!-- Request Information Section -->
    <div class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-lg p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-6">Request Information</h2>
      <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
        <!-- Purpose -->
        <div>
          <%= label_tag "reimbursement_request[form_data][purpose]", class: label_classes do %>
            Purpose <%= required_asterisk %>
          <% end %>
          <%= text_field_tag "reimbursement_request[form_data][purpose]", 
                form_data['purpose'], 
                class: input_class_for_field('purpose'),
                maxlength: 255,
                required: true,
                placeholder: "e.g., Event expenses, travel costs",
                data: { action: "input->reimbursement-form#validateField" } %>
          <%= field_error('purpose') %>
        </div>

        <!-- Urgency -->
        <div>
          <%= label_tag "reimbursement_request[form_data][urgency]", class: label_classes do %>
            Urgency
          <% end %>
          <%= select_tag "reimbursement_request[form_data][urgency]", 
                options_for_select(urgency_options, form_data['urgency'] || 'normal'), 
                class: input_class_for_field('urgency'),
                data: { action: "change->reimbursement-form#validateField" } %>
          <%= field_error('urgency') %>
        </div>

        <!-- Expense Category -->
        <div>
          <%= label_tag "reimbursement_request[form_data][expense_category_code]", class: label_classes do %>
            Expense Category <%= required_asterisk %>
          <% end %>
          <%= select_tag "reimbursement_request[form_data][expense_category_code]", 
                options_for_select([['Select category...', '']] + expense_categories, form_data['expense_category_code']), 
                class: input_class_for_field('expense_category_code'),
                required: true,
                data: { action: "change->reimbursement-form#validateField" } %>
          <%= field_error('expense_category_code') %>
        </div>

        <!-- Chapter -->
        <div>
          <%= label_tag "reimbursement_request[form_data][chapter]", class: label_classes do %>
            Chapter
          <% end %>
          <%= text_field_tag "reimbursement_request[form_data][chapter]", 
                form_data['chapter'], 
                class: input_class_for_field('chapter'),
                maxlength: 255,
                placeholder: "e.g., Berlin, London",
                data: { action: "input->reimbursement-form#validateField" } %>
          <%= field_error('chapter') %>
        </div>

        <!-- Amount Requested -->
        <div>
          <%= label_tag "reimbursement_request[amount_requested]", class: label_classes do %>
            Amount Requested <%= required_asterisk %>
          <% end %>
          <div class="flex">
            <div class="relative flex-1">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <span class="text-gray-500 sm:text-sm">$</span>
              </div>
              <%= number_field_tag "reimbursement_request[amount_requested]", 
                    reimbursement_request.amount_requested, 
                    class: input_class_for_field('amount_requested') + " pl-7 rounded-r-none",
                    step: 0.01,
                    min: 0.01,
                    required: true,
                    data: { action: "input->reimbursement-form#validateField" } %>
            </div>
            <%= select_tag "reimbursement_request[currency_code]", 
                  options_for_select([['USD', 'USD'], ['EUR', 'EUR'], ['GBP', 'GBP'], ['CAD', 'CAD'], ['AUD', 'AUD']], reimbursement_request.currency_code || 'USD'), 
                  class: input_classes + " rounded-l-none border-l-0 w-20" %>
          </div>
          <%= field_error('amount_requested') %>
        </div>

        <!-- Date Incurred -->
        <div>
          <%= label_tag "reimbursement_request[form_data][date_incurred]", class: label_classes do %>
            Date Incurred <%= required_asterisk %>
          <% end %>
          <%= date_field_tag "reimbursement_request[form_data][date_incurred]", 
                form_data['date_incurred'], 
                class: input_class_for_field('date_incurred'),
                max: Date.current,
                required: true,
                data: { action: "change->reimbursement-form#validateField" } %>
          <%= field_error('date_incurred') %>
        </div>

        <!-- Description -->
        <div class="sm:col-span-2">
          <%= label_tag "reimbursement_request[form_data][description]", class: label_classes do %>
            Description <%= required_asterisk %>
          <% end %>
          <%= text_area_tag "reimbursement_request[form_data][description]", 
                form_data['description'], 
                class: input_class_for_field('description'),
                rows: 4,
                maxlength: 1000,
                required: true,
                placeholder: "Detailed description of expenses to be reimbursed",
                data: { action: "input->reimbursement-form#validateField" } %>
          <%= field_error('description') %>
        </div>
      </div>
    </div>

    <!-- Payment Information Section -->
    <div class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-lg p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-6">Payment Information</h2>
      <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
        <!-- Payment Method -->
        <div>
          <%= label_tag "reimbursement_request[form_data][payment_method]", class: label_classes do %>
            Original Payment Method <%= required_asterisk %>
          <% end %>
          <%= select_tag "reimbursement_request[form_data][payment_method]", 
                options_for_select([['Select method...', '']] + payment_methods, form_data['payment_method']), 
                class: input_class_for_field('payment_method'),
                required: true,
                data: { action: "change->reimbursement-form#validateField" } %>
          <%= field_error('payment_method') %>
          <p class="mt-1 text-sm text-gray-500">How did you originally pay for this expense?</p>
        </div>

        <!-- Payee Name -->
        <div>
          <%= label_tag "reimbursement_request[form_data][payee_name]", class: label_classes do %>
            Payee Name <%= required_asterisk %>
          <% end %>
          <%= text_field_tag "reimbursement_request[form_data][payee_name]", 
                form_data['payee_name'], 
                class: input_class_for_field('payee_name'),
                maxlength: 255,
                required: true,
                placeholder: "Person to be reimbursed",
                data: { action: "input->reimbursement-form#validateField" } %>
          <%= field_error('payee_name') %>
        </div>

        <!-- Payee Email -->
        <div>
          <%= label_tag "reimbursement_request[form_data][payee_email]", class: label_classes do %>
            Payee Email <%= required_asterisk %>
          <% end %>
          <%= email_field_tag "reimbursement_request[form_data][payee_email]", 
                form_data['payee_email'], 
                class: input_class_for_field('payee_email'),
                required: true,
                placeholder: "For payment notifications",
                data: { action: "input->reimbursement-form#validateField" } %>
          <%= field_error('payee_email') %>
        </div>

        <!-- Payee Address -->
        <div>
          <%= label_tag "reimbursement_request[form_data][payee_address]", class: label_classes do %>
            Payee Address
          <% end %>
          <%= text_area_tag "reimbursement_request[form_data][payee_address]", 
                form_data['payee_address'], 
                class: input_class_for_field('payee_address'),
                rows: 3,
                maxlength: 500,
                placeholder: "Mailing address (if check payment required)",
                data: { action: "input->reimbursement-form#validateField" } %>
          <%= field_error('payee_address') %>
        </div>
      </div>
    </div>

    <!-- Receipt Upload Section -->
    <div class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-lg p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-6">Receipt Upload</h2>
      <div>
        <%= label_tag "reimbursement_request[receipts]", class: label_classes do %>
          Receipts <%= required_asterisk %>
        <% end %>
        <%= file_field_tag "reimbursement_request[receipts]", 
              multiple: true,
              accept: "image/*,application/pdf",
              class: "block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",
              required: true,
              data: { action: "change->reimbursement-form#validateFiles" } %>
        <p class="mt-1 text-sm text-gray-500">Upload receipts or supporting documents (PDF, JPG, PNG). Max 10MB per file.</p>
        <%= field_error('receipts') %>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="flex items-center justify-end space-x-4 pt-6 border-t border-gray-200">
      <%= link_to "Cancel", reimbursement_requests_path, 
            class: "inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" %>
      
      <%= form.submit "Submit Request", 
            class: "inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",
            data: { action: "click->reimbursement-form#validateForm" } %>
    </div>
  <% end %>
</div>